# üêã Odoo Docker Deployment

Este proyecto proporciona una configuraci√≥n Docker para el despliegue automatizado de Odoo, dise√±ado para facilitar
tanto entornos de desarrollo como de producci√≥n.

## üìã Requisitos Previos

- Docker Engine (20.10.0 o superior)
- Docker Compose (2.0.0 o superior)
- Git
- Libreria de python `dotenv`

## üöÄ Inicio R√°pido

1. Clona el repositorio:
   `git clone https://github.com/zoltar238/pymtech_docker.git`

2. Crea la red externa de traefik:
   `docker network create traefik`. La red externa de traefik deber√° existir tanto
   en entornos de producci√≥n como de desarrollo

3. Determina el entorno:
    1. En entornos de producci√≥n ser√° necesario el contenedor de "traefik" para el proxy inverso.
       Dentro de la carpeta de traefik, con la red externa creada, ejecuta `docker compose up -d`
       para iniciar el servicio y `docker compose down` para detenerlo
    2. En entornos de desarrollo el contenedor de traefik no es necesario y se puede eliminar

4. Accede a la carpeta del contenedor de odoo y modifica los par√°metros del servicio
   contenidos en el archivo: `.env`

5. Lanza el servicio de Odoo desde la carpeta del contenedor ejecutando: `python3 deploy.py`
   Usa el mismo comando para reiniciar los contenedores de odoo. Usa `docker compose down` en caso
   de que sea necesario detener el servicio de odoo

## ‚öôÔ∏è Configuraci√≥n

## ‚öôÔ∏è Configuraci√≥n Detallada del Archivo .env

### Configuraci√≥n Principal

| Variable             | Descripci√≥n                                                                             | Valores Posibles                 | Valor por Defecto |
|----------------------|-----------------------------------------------------------------------------------------|----------------------------------|-------------------|
| COMPOSE_PROJECT_NAME | Nombre del proyecto. Crucial para separar datos entre instancias y nombrar contenedores | Texto libre (ej: client_name_18) | example_name      |
| DEPLOYMENT_TARGET    | Define el entorno de despliegue                                                         | dev/prod                         | dev               |
| SCRIPT_OUTPUT        | Nivel de detalle en la salida del script deploy.py                                      | verbose/silent                   | verbose           |

### Versiones y Contenedores

| Variable         | Descripci√≥n                | Valor por Defecto |
|------------------|----------------------------|-------------------|
| ODOO_VERSION     | Versi√≥n de Odoo a utilizar | 18                |
| POSTGRES_VERSION | Versi√≥n de PostgreSQL      | 15                |

### Red y Conectividad

| Variable           | Descripci√≥n                                       | Valor por Defecto |
|--------------------|---------------------------------------------------|-------------------|
| DOMAIN             | Dominio para el servicio (ej: example.loxika.com) | vac√≠o             |
| ODOO_EXPOSED_PORT  | Puerto externo para acceder a Odoo                | 8075              |
| ODOO_INTERNAL_PORT | Puerto interno del contenedor                     | 8069              |

### Sistema de Archivos y Rutas

| Variable          | Descripci√≥n                           | Valor por Defecto       |
|-------------------|---------------------------------------|-------------------------|
| ODOO_LOG          | Ruta de los archivos de registro      | ./log                   |
| ODOO_CONFIG       | Ruta de los archivos de configuraci√≥n | ./config                |
| ODOO_ADDONS       | Ruta de los m√≥dulos adicionales       | ./addons                |
| ODOO_REQUIREMENTS | Ruta del archivo requirements.txt     | addons/requirements.txt |

### Gesti√≥n de M√≥dulos

| Variable             | Descripci√≥n                                       | Valores Posibles            | Valor por Defecto |
|----------------------|---------------------------------------------------|-----------------------------|-------------------|
| AUTO_INSTALL_MODULES | Instala m√≥dulos autom√°ticamente al iniciar        | true/false                  | false             |
| AUTO_UPDATE_MODULES  | Actualiza m√≥dulos autom√°ticamente al iniciar      | true/false                  | true              |
| UPDATE_MODULE_LIST   | Lista espec√≠fica de m√≥dulos a actualizar          | nombres separados por comas | vac√≠o             |
| FORCE_UPDATE         | Fuerza la actualizaci√≥n de m√≥dulos (¬°Precauci√≥n!) | true/false                  | false             |

### Construcci√≥n y Desarrollo

| Variable      | Descripci√≥n                                 | Valores Posibles | Valor por Defecto |
|---------------|---------------------------------------------|------------------|-------------------|
| FORCE_REBUILD | Reconstruye la imagen Docker en cada inicio | true/false       | false             |

### Caracter√≠sticas Opcionales

| Variable         | Descripci√≥n                      | Valores Posibles | Valor por Defecto |
|------------------|----------------------------------|------------------|-------------------|
| OPTIONAL_WHISPER | Habilita el soporte para Whisper | true/false       | true              |

### ‚ö†Ô∏è Notas Importantes

- El `COMPOSE_PROJECT_NAME` es obligatorio y crucial para el correcto funcionamiento del sistema
- Modificar `FORCE_UPDATE` puede causar problemas en la instalaci√≥n de Odoo
- `UPDATE_MODULE_LIST` tiene prioridad sobre `AUTO_UPDATE_MODULES`
- Aseg√∫rate de que `ODOO_EXPOSED_PORT` no est√© siendo utilizado por otra aplicaci√≥n
- Asegurarse de que la carpeta de `logs` y `addons` dentro de odoo tienen permisos de escritura
- En caso de errores con redes, eliminar la red mencionada en el error de docker con `docker network rm <nombre_red>`

## üìÅ Estructura de Directorios de ejemplo

Aqu√≠ se muestra una estructura de directorios de ejemplo, centr√°ndose solo en aquellos archivos importantes para el
funcionamiento del proyecto:

<pre>
ruta_de_los_contenedores/
    ‚îú‚îÄ‚îÄ odoo_empresa_1
    ‚îÇ ‚îú‚îÄ‚îÄ addons
    ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ requirements.txt
    ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ modulo1
    ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ modulo2
    ‚îÇ ‚îú‚îÄ‚îÄ config
    ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ odoo.conf
    ‚îÇ ‚îú‚îÄ‚îÄ deploy.py
    ‚îÇ ‚îú‚îÄ‚îÄ docker-compose.yml
    ‚îÇ ‚îú‚îÄ‚îÄ log
    ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ odoo-server.log
    ‚îÇ ‚îú‚îÄ‚îÄ odoo.Dockerfile
    ‚îî‚îÄ‚îÄ traefik
      ‚îî‚îÄ‚îÄ docker-compose.yml
</pre>